
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gratuity Calculator for Central Government Employees</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a4f7a;
            --secondary: #2c7bb6;
            --accent: #e63946;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --border-radius: 12px;
            --box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --gradient-primary: linear-gradient(135deg, #1a4f7a 0%, #2c7bb6 100%);
            --gradient-secondary: linear-gradient(135deg, #2c7bb6 0%, #3aa7d9 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }

        header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        header h1 i {
            font-size: 1.8rem;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .app-container {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1200px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .output-section {
            display: flex;
            flex-direction: column;
        }

        .section-title {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #e9ecef;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--secondary);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark);
            font-size: 1rem;
        }

        .form-control {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #e1e5eb;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: #fafbff;
        }

        .form-control:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 123, 182, 0.2);
            background-color: white;
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 8px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            border: 2px solid #e1e5eb;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            background-color: #fafbff;
            font-size: 0.95rem;
        }

        .radio-option:hover {
            border-color: var(--secondary);
            background-color: #f0f7ff;
        }

        .radio-option input {
            margin: 0;
            width: 16px;
            height: 16px;
        }

        .radio-option input:checked + label {
            color: var(--primary);
            font-weight: 600;
        }

        .radio-option label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
        }

        .btn {
            display: inline-block;
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 13px 20px;
            font-size: 1.05rem;
            font-weight: 600;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            width: 100%;
            margin-bottom: 8px;
            box-shadow: 0 4px 8px rgba(26, 79, 122, 0.25);
        }

        .btn:hover {
            background: var(--gradient-secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(26, 79, 122, 0.35);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #34d058 100%);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.25);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #218838 0%, #28a745 100%);
            box-shadow: 0 6px 12px rgba(40, 167, 69, 0.35);
        }

        .result-item {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: var(--border-radius);
            background-color: #f8f9fa;
            border-left: 4px solid var(--secondary);
            transition: var(--transition);
        }

        .result-item:hover {
            background-color: #f0f7ff;
            transform: translateX(3px);
        }

        .result-label {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 4px;
            font-size: 1rem;
        }

        .result-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark);
        }

        .highlight {
            background-color: #e7f3ff;
            border-left: 4px solid var(--secondary);
        }

        .note {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 6px;
            font-style: italic;
        }

        .alert {
            padding: 16px;
            border-radius: var(--border-radius);
            margin-bottom: 16px;
            font-size: 0.95rem;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .alert i {
            font-size: 1.3rem;
            margin-top: 2px;
        }

        .alert-info {
            background-color: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }

        .alert-info i {
            color: #17a2b8;
        }

        .alert-success {
            background-color: #d4edda;
            border-left: 4px solid var(--success);
            color: #155724;
        }

        .alert-success i {
            color: var(--success);
        }

        .alert-warning {
            background-color: #fff3cd;
            border-left: 4px solid var(--warning);
            color: #856404;
        }

        .alert-warning i {
            color: var(--warning);
        }

        .alert-danger {
            background-color: #f8d7da;
            border-left: 4px solid var(--danger);
            color: #721c24;
        }

        .alert-danger i {
            color: var(--danger);
        }

        .calculation-steps {
            margin-top: 20px;
            padding-top: 16px;
            border-top: 2px dashed #e9ecef;
        }

        .step {
            margin-bottom: 12px;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 8px;
            position: relative;
            padding-left: 40px;
        }

        .step-number {
            position: absolute;
            left: 12px;
            top: 12px;
            background: var(--gradient-primary);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            font-size: 0.9rem;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-top: 20px;
        }

        .date-inputs {
            display: flex;
            gap: 12px;
        }

        .date-inputs > div {
            flex: 1;
        }

        .hidden {
            display: none;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--box-shadow);
            text-align: center;
            transition: var(--transition);
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .summary-card i {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .summary-card h3 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .summary-card p {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
        }

        .service-card {
            background: linear-gradient(135deg, #2c7bb6 0%, #1a4f7a 100%);
            color: white;
        }

        .service-card i {
            color: #ffd700;
        }

        .amount-card {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            color: white;
        }

        .amount-card i {
            color: #ffd700;
        }

        .type-card {
            background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);
            color: white;
        }

        .type-card i {
            color: #ffd700;
        }

        .periods-card {
            background: linear-gradient(135deg, #fd7e14 0%, #e06a0d 100%);
            color: white;
        }

        .periods-card i {
            color: #ffd700;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .results-header h2 {
            margin: 0;
        }

        .export-btn-container {
            margin-top: auto;
            padding-top: 15px;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .app-container {
                gap: 15px;
            }
            
            .card {
                padding: 15px;
            }
            
            header h1 {
                font-size: 1.6rem;
            }
            
            header p {
                font-size: 0.95rem;
            }
            
            .date-inputs {
                flex-direction: column;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-calculator"></i>Gratuity Calculator</h1>
            <p>Designed by Anil Kumar VT | Calculated as per CCS (Pension) Rules, 2021</p>
        </header>

        <div class="app-container">
            <div class="input-section">
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-user"></i> Employee Details</h2>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="employeeName">Employee Name</label>
                            <input type="text" id="employeeName" class="form-control" placeholder="Enter full name">
                        </div>

                        <div class="form-group">
                            <label for="designation">Designation</label>
                            <input type="text" id="designation" class="form-control" placeholder="Enter designation">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="section-title"><i class="fas fa-clock"></i> Service Details</h2>
                    
                    <div class="form-group">
                        <label>Calculation Type</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="retirement" name="calculationType" value="retirement" checked>
                                <label for="retirement">Retirement Gratuity</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="death" name="calculationType" value="death">
                                <label for="death">Death Gratuity</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="dateOfJoining">Date of Joining Service</label>
                            <input type="date" id="dateOfJoining" class="form-control">
                        </div>

                        <div class="form-group" id="retirementDateGroup">
                            <label for="dateOfRetirement">Date of Retirement</label>
                            <input type="date" id="dateOfRetirement" class="form-control">
                        </div>

                        <div class="form-group hidden" id="deathDateGroup">
                            <label for="dateOfDeath">Date of Death</label>
                            <input type="date" id="dateOfDeath" class="form-control">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="section-title"><i class="fas fa-money-bill-wave"></i> Emoluments Details</h2>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="basicPay">Basic Pay at Retirement/Death (₹)</label>
                            <input type="number" id="basicPay" class="form-control" min="0" placeholder="Enter basic pay">
                        </div>

                        <div class="form-group">
                            <label for="daPercentage">Dearness Allowance Percentage (%)</label>
                            <input type="number" id="daPercentage" class="form-control" min="0" max="100" step="0.01" placeholder="Enter DA percentage">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="averageEmoluments">Average Emoluments (₹)</label>
                        <input type="number" id="averageEmoluments" class="form-control" min="0" placeholder="Enter average of last 10 months">
                        <div class="note">Average of last 10 months' emoluments</div>
                    </div>

                    <button id="calculateBtn" class="btn"><i class="fas fa-calculator"></i> Calculate Gratuity</button>
                </div>
            </div>

            <div class="output-section">
                <div class="card" style="flex: 1; display: flex; flex-direction: column;">
                    <div class="results-header">
                        <h2 class="section-title"><i class="fas fa-chart-bar"></i> Calculation Results</h2>
                    </div>
                    
                    <div id="resultsContainer" style="flex: 1;">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <div>
                                <strong>Welcome to the Gratuity Calculator</strong>
                                <p>Please enter your details and click "Calculate Gratuity" to see results.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="export-btn-container">
                        <button id="exportPdfBtn" class="btn btn-success hidden"><i class="fas fa-file-pdf"></i> Export to PDF</button>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p><strong>Disclaimer:</strong> This calculator provides estimates based on the Central Civil Services Pension Rules, 2021. Actual gratuity amounts may vary based on specific circumstances and official interpretations.</p>
            <p>© 2025 Advanced Gratuity Calculator for Central Government Employees</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculateBtn');
            const exportPdfBtn = document.getElementById('exportPdfBtn');
            const resultsContainer = document.getElementById('resultsContainer');
            const retirementDateGroup = document.getElementById('retirementDateGroup');
            const deathDateGroup = document.getElementById('deathDateGroup');
            const calculationTypeRadios = document.querySelectorAll('input[name="calculationType"]');
            
            // Toggle between retirement and death date inputs
            calculationTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'retirement') {
                        retirementDateGroup.classList.remove('hidden');
                        deathDateGroup.classList.add('hidden');
                    } else {
                        retirementDateGroup.classList.add('hidden');
                        deathDateGroup.classList.remove('hidden');
                    }
                });
            });
            
            calculateBtn.addEventListener('click', calculateGratuity);
            exportPdfBtn.addEventListener('click', exportToPdf);
            
            function calculateGratuity() {
                // Get employee details
                const employeeName = document.getElementById('employeeName').value;
                const designation = document.getElementById('designation').value;
                
                // Get calculation type
                const calculationType = document.querySelector('input[name="calculationType"]:checked').value;
                
                // Get dates
                const dateOfJoining = new Date(document.getElementById('dateOfJoining').value);
                let endDate;
                
                if (calculationType === 'retirement') {
                    endDate = new Date(document.getElementById('dateOfRetirement').value);
                } else {
                    endDate = new Date(document.getElementById('dateOfDeath').value);
                }
                
                // Get emoluments details
                const basicPay = parseFloat(document.getElementById('basicPay').value) || 0;
                const daPercentage = parseFloat(document.getElementById('daPercentage').value) || 0;
                const averageEmoluments = parseFloat(document.getElementById('averageEmoluments').value) || 0;
                
                // Validate inputs
                if (!employeeName || !designation) {
                    showError("Please enter employee name and designation.");
                    return;
                }
                
                if (isNaN(dateOfJoining.getTime())) {
                    showError("Please enter a valid date of joining.");
                    return;
                }
                
                if (isNaN(endDate.getTime())) {
                    showError(`Please enter a valid date of ${calculationType === 'retirement' ? 'retirement' : 'death'}.`);
                    return;
                }
                
                if (basicPay <= 0 || daPercentage < 0) {
                    showError("Please enter valid basic pay and DA percentage values.");
                    return;
                }
                
                if (averageEmoluments <= 0) {
                    showError("Please enter a valid average emoluments value.");
                    return;
                }
                
                // Calculate service period
                const servicePeriod = calculateServicePeriod(dateOfJoining, endDate);
                let years = servicePeriod.years;
                let months = servicePeriod.months;
                const totalMonths = years * 12 + months;
                
                // Apply maximum service limit of 33 years for gratuity calculation
                let serviceLimited = false;
                if (years > 33 || (years === 33 && months > 0)) {
                    serviceLimited = true;
                    years = 33;
                    months = 0;
                }
                
                // Calculate last drawn emoluments
                const daAmount = basicPay * (daPercentage / 100);
                const lastDrawnEmoluments = basicPay + daAmount;
                
                // Calculate emoluments (higher of last drawn or average)
                const emoluments = Math.max(lastDrawnEmoluments, averageEmoluments);
                
                // Calculate qualifying service in six-monthly periods
                const totalPeriods = calculateSixMonthlyPeriods(years, months);
                
                // Perform calculation based on calculation type
                let gratuityAmount = 0;
                const maxMultiplier = 16.5; // Maximum at 33 years/66 periods
                const maxCeiling = 2500000; // 25 Lakhs
                let gratuityType = '';
                let calculationSteps = [];
                let eligibilityError = false;
                
                if (calculationType === 'retirement') {
                    // Check eligibility for Retirement Gratuity (minimum 5 years service)
                    if (totalMonths < 60) {
                        showError("Retirement Gratuity requires minimum 5 years of qualifying service. For service less than 5 years, only Death Gratuity is payable.");
                        eligibilityError = true;
                        return;
                    }
                    
                    gratuityType = 'Retirement Gratuity (RG)';
                    
                    calculationSteps.push("Eligibility: 5+ years of qualifying service confirmed");
                    calculationSteps.push(`Formula: RG = Emoluments × 1/4 × Total Six-Monthly Periods (P)`);
                    calculationSteps.push(`Calculation: Rs.${emoluments.toLocaleString()} × 1/4 × ${totalPeriods}`);
                    
                    gratuityAmount = emoluments * (1/4) * totalPeriods;
                    
                    // Apply maximum multiplier (16.5 times emoluments)
                    const maxByMultiplier = emoluments * maxMultiplier;
                    if (gratuityAmount > maxByMultiplier) {
                        calculationSteps.push(`Maximum multiplier applied: Rs.${emoluments.toLocaleString()} × ${maxMultiplier} = Rs.${maxByMultiplier.toLocaleString()}`);
                        gratuityAmount = maxByMultiplier;
                    }
                    
                    // Apply monetary ceiling for RG
                    if (gratuityAmount > maxCeiling) {
                        calculationSteps.push(`Monetary ceiling applied: Rs.${gratuityAmount.toLocaleString()} limited to Rs.${maxCeiling.toLocaleString()}`);
                        gratuityAmount = maxCeiling;
                    }
                } else {
                    // Death Gratuity - No minimum service requirement
                    gratuityType = 'Death Gratuity (DG)';
                    
                    if (totalMonths < 12) {
                        // Less than 1 year
                        calculationSteps.push("Service Duration: Less than 1 year");
                        calculationSteps.push(`Formula: DG = Emoluments × 2`);
                        calculationSteps.push(`Calculation: Rs.${emoluments.toLocaleString()} × 2`);
                        
                        gratuityAmount = emoluments * 2;
                    } else if (totalMonths >= 12 && totalMonths < 60) {
                        // 1 year or more but less than 5 years
                        calculationSteps.push("Service Duration: 1 year or more but less than 5 years");
                        calculationSteps.push(`Formula: DG = Emoluments × 6`);
                        calculationSteps.push(`Calculation: Rs.${emoluments.toLocaleString()} × 6`);
                        
                        gratuityAmount = emoluments * 6;
                    } else if (totalMonths >= 60 && totalMonths < 132) {
                        // 5 years or more but less than 11 years
                        calculationSteps.push("Service Duration: 5 years or more but less than 11 years");
                        calculationSteps.push(`Formula: DG = Emoluments × 12`);
                        calculationSteps.push(`Calculation: Rs.${emoluments.toLocaleString()} × 12`);
                        
                        gratuityAmount = emoluments * 12;
                    } else if (totalMonths >= 132 && totalMonths < 240) {
                        // 11 years or more but less than 20 years
                        calculationSteps.push("Service Duration: 11 years or more but less than 20 years");
                        calculationSteps.push(`Formula: DG = Emoluments × 20`);
                        calculationSteps.push(`Calculation: Rs.${emoluments.toLocaleString()} × 20`);
                        
                        gratuityAmount = emoluments * 20;
                    } else {
                        // 20 years or more
                        calculationSteps.push("Service Duration: 20 years or more");
                        calculationSteps.push(`Formula: DG = Emoluments × 1/2 × Total Six-Monthly Periods (P)`);
                        calculationSteps.push(`Calculation: Rs.${emoluments.toLocaleString()} × 1/2 × ${totalPeriods}`);
                        
                        gratuityAmount = emoluments * (1/2) * totalPeriods;
                        
                        // Apply maximum multiplier for 20+ years slab (33 times emoluments)
                        const maxByMultiplierDG = emoluments * 33;
                        if (gratuityAmount > maxByMultiplierDG) {
                            calculationSteps.push(`Maximum multiplier applied: Rs.${emoluments.toLocaleString()} × 33 = Rs.${maxByMultiplierDG.toLocaleString()}`);
                            gratuityAmount = maxByMultiplierDG;
                        }
                    }
                    
                    // Apply monetary ceiling for DG
                    if (gratuityAmount > maxCeiling) {
                        calculationSteps.push(`Monetary ceiling applied: Rs.${gratuityAmount.toLocaleString()} limited to Rs.${maxCeiling.toLocaleString()}`);
                        gratuityAmount = maxCeiling;
                    }
                }
                
                if (eligibilityError) return;
                
                // Round up to the next higher rupee if there's a fraction
                if (gratuityAmount % 1 !== 0) {
                    const originalAmount = gratuityAmount;
                    gratuityAmount = Math.ceil(gratuityAmount);
                    calculationSteps.push(`Rounded up to next higher rupee: Rs.${originalAmount.toFixed(2)} → Rs.${gratuityAmount.toLocaleString()}`);
                }
                
                // Store data for PDF export
                window.calculationData = {
                    employeeName,
                    designation,
                    gratuityType,
                    basicPay,
                    daPercentage,
                    daAmount,
                    lastDrawnEmoluments,
                    averageEmoluments,
                    emoluments,
                    dateOfJoining: formatDate(dateOfJoining),
                    endDate: formatDate(endDate),
                    endDateType: calculationType === 'retirement' ? 'Retirement' : 'Death',
                    years,
                    months,
                    totalMonths,
                    totalPeriods,
                    gratuityAmount,
                    calculationSteps,
                    serviceLimited,
                    maxMultiplier,
                    maxCeiling
                };
                
                // Display results
                displayResults();
                exportPdfBtn.classList.remove('hidden');
            }
            
            function calculateServicePeriod(startDate, endDate) {
                let years = endDate.getFullYear() - startDate.getFullYear();
                let months = endDate.getMonth() - startDate.getMonth();
                
                if (months < 0) {
                    years--;
                    months += 12;
                }
                
                // Adjust for day of month
                if (endDate.getDate() < startDate.getDate()) {
                    months--;
                    if (months < 0) {
                        years--;
                        months += 12;
                    }
                }
                
                return { years, months };
            }
            
            // Function to calculate six-monthly periods with proper rounding and maximum limit
            function calculateSixMonthlyPeriods(years, months) {
                // Maximum service for gratuity is 33 years (66 periods)
                const maxPeriods = 66;
                
                let totalPeriods = years * 2; // Each year gives 2 six-monthly periods
                
                // Handle the remaining months
                if (months >= 6) {
                    // If 6 or more months, we have at least one complete six-month period
                    totalPeriods += 1;
                    months -= 6;
                }
                
                // For remaining months (0-5 months), apply rounding rules
                if (months >= 3 && months <= 5) {
                    // 3-5 months: round up by adding one more period
                    totalPeriods += 1;
                }
                // 0-2 months: disregard (no additional period)
                
                // Apply maximum limit of 66 periods
                return Math.min(totalPeriods, maxPeriods);
            }
            
            function formatDate(date) {
                return date.toLocaleDateString('en-IN', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            }
            
            function displayResults() {
                const data = window.calculationData;
                
                // Create summary cards
                let summaryCards = `
                    <div class="summary-cards">
                        <div class="summary-card amount-card">
                            <i class="fas fa-rupee-sign"></i>
                            <h3>Gratuity Amount</h3>
                            <p>Rs.${data.gratuityAmount.toLocaleString()}</p>
                        </div>
                        
                        <div class="summary-card service-card">
                            <i class="fas fa-calendar-alt"></i>
                            <h3>Service Period</h3>
                            <p>${data.years}Y ${data.months}M</p>
                        </div>
                        
                        <div class="summary-card type-card">
                            <i class="fas fa-tag"></i>
                            <h3>Gratuity Type</h3>
                            <p>${data.gratuityType.split(' ')[0]}</p>
                        </div>
                        
                        <div class="summary-card periods-card">
                            <i class="fas fa-sync-alt"></i>
                            <h3>Six-Monthly Periods</h3>
                            <p>${data.totalPeriods}</p>
                        </div>
                    </div>
                `;
                
                // Create detailed results
                let resultsHTML = `
                    ${summaryCards}
                    
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <strong>Gratuity Calculation Complete</strong>
                            <p>Your gratuity has been calculated successfully based on the provided details.</p>
                        </div>
                    </div>
                    
                    <div class="result-item highlight">
                        <div class="result-label">Final Gratuity Amount</div>
                        <div class="result-value">Rs.${data.gratuityAmount.toLocaleString()}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Employee Name</div>
                        <div class="result-value">${data.employeeName}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Designation</div>
                        <div class="result-value">${data.designation}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Gratuity Type</div>
                        <div class="result-value">${data.gratuityType}</div>
                    </div>
                `;
                
                // Add service limitation notice if applicable
                if (data.serviceLimited) {
                    resultsHTML += `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>
                                <strong>Note:</strong> Service limited to maximum 33 years for gratuity calculation as per rules.
                            </div>
                        </div>
                    `;
                }
                
                resultsHTML += `
                    <div class="result-item">
                        <div class="result-label">Date of Joining</div>
                        <div class="result-value">${data.dateOfJoining}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Date of ${data.endDateType}</div>
                        <div class="result-value">${data.endDate}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Qualifying Service</div>
                        <div class="result-value">${data.years} Years ${data.months} Months (${data.totalMonths} months)</div>
                        ${data.serviceLimited ? '<div class="note">Limited to maximum 33 years for gratuity calculation</div>' : ''}
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Total Completed Six-Monthly Periods (P)</div>
                        <div class="result-value">${data.totalPeriods}</div>
                        <div class="note">${data.totalPeriods === 66 ? 'Maximum limit of 66 periods reached' : `Calculated as: ${data.years} years × 2 = ${data.years * 2} periods + ${getMonthsExplanation(data.months)}`}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Basic Pay</div>
                        <div class="result-value">Rs.${data.basicPay.toLocaleString()}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Dearness Allowance (${data.daPercentage}%)</div>
                        <div class="result-value">Rs.${data.daAmount.toLocaleString()}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Last Drawn Emoluments</div>
                        <div class="result-value">Rs.${data.lastDrawnEmoluments.toLocaleString()}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Average Emoluments</div>
                        <div class="result-value">Rs.${data.averageEmoluments.toLocaleString()}</div>
                    </div>
                    
                    <div class="result-item highlight">
                        <div class="result-label">Emoluments for Gratuity Calculation</div>
                        <div class="result-value">Rs.${data.emoluments.toLocaleString()}</div>
                        <div class="note">Higher of last drawn emoluments (Rs.${data.lastDrawnEmoluments.toLocaleString()}) or average emoluments (Rs.${data.averageEmoluments.toLocaleString()})</div>
                    </div>
                `;
                
                // Add calculation steps
                if (data.calculationSteps && data.calculationSteps.length > 0) {
                    resultsHTML += `
                        <div class="calculation-steps">
                            <h3 class="section-title"><i class="fas fa-calculator"></i> Calculation Steps</h3>
                            ${data.calculationSteps.map((step, index) => `
                                <div class="step">
                                    <div class="step-number">${index + 1}</div>
                                    <div>${step}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                // Add important notes
                resultsHTML += `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>Important Rules:</strong>
                            <ul style="margin-top: 8px; margin-left: 20px;">
                                <li>Retirement Gratuity requires minimum 5 years of qualifying service</li>
                                <li>Death Gratuity has no minimum service requirement</li>
                                <li>Maximum gratuity amount: Rs.25,00,000</li>
                                <li>Fractions of rupee are rounded up to next higher rupee</li>
                            </ul>
                        </div>
                    </div>
                `;
                
                resultsContainer.innerHTML = resultsHTML;
            }
            
            function getMonthsExplanation(months) {
                if (months === 0) return "0 months = 0 additional periods";
                if (months < 3) return `${months} months = 0 additional periods (less than 3 months disregarded)`;
                if (months >= 3 && months < 6) return `${months} months = 1 additional period (3-5 months rounded up)`;
                if (months >= 6) return `${months} months = 1 additional period (6+ months = 1 period)`;
                return "";
            }
            
            function showError(message) {
                resultsContainer.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <strong>Error</strong>
                            <p>${message}</p>
                        </div>
                    </div>
                `;
                exportPdfBtn.classList.add('hidden');
            }
            
            function exportToPdf() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const data = window.calculationData;
                
                // Add header
                doc.setFillColor(26, 79, 122);
                doc.rect(0, 0, 210, 30, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(18);
                doc.text('Gratuity Calculation Report', 105, 15, { align: 'center' });
                doc.setFontSize(10);
                doc.text('Designed by Anil Kumar VT | CCS (Pension) Rules, 2021', 105, 22, { align: 'center' });
                
                // Add content
                doc.setTextColor(0, 0, 0);
                let yPosition = 45;
                
                // Employee details
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('Employee Details', 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                doc.text(`Name: ${data.employeeName}`, 20, yPosition);
                doc.text(`Designation: ${data.designation}`, 110, yPosition);
                yPosition += 7;
                
                doc.text(`Date of Joining: ${data.dateOfJoining}`, 20, yPosition);
                doc.text(`Date of ${data.endDateType}: ${data.endDate}`, 110, yPosition);
                yPosition += 7;
                
                doc.text(`Qualifying Service: ${data.years} Years ${data.months} Months`, 20, yPosition);
                doc.text(`Six-Monthly Periods: ${data.totalPeriods}`, 110, yPosition);
                yPosition += 15;
                
                // Emoluments details
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('Emoluments Details', 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                doc.text(`Basic Pay: Rs.${data.basicPay.toLocaleString()}`, 20, yPosition);
                doc.text(`DA Percentage: ${data.daPercentage}%`, 110, yPosition);
                yPosition += 7;
                
                doc.text(`DA Amount: Rs.${data.daAmount.toLocaleString()}`, 20, yPosition);
                yPosition += 7;
                
                doc.text(`Last Drawn Emoluments: Rs.${data.lastDrawnEmoluments.toLocaleString()}`, 20, yPosition);
                yPosition += 7;
                
                doc.text(`Average Emoluments: Rs.${data.averageEmoluments.toLocaleString()}`, 20, yPosition);
                yPosition += 7;
                
                doc.setFont(undefined, 'bold');
                doc.text(`Emoluments for Calculation: Rs.${data.emoluments.toLocaleString()}`, 20, yPosition);
                yPosition += 15;
                
                // Gratuity calculation
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('Gratuity Calculation', 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                doc.text(`Gratuity Type: ${data.gratuityType}`, 20, yPosition);
                yPosition += 7;
                
                doc.setFont(undefined, 'bold');
                doc.text(`Final Gratuity Amount: Rs.${data.gratuityAmount.toLocaleString()}`, 20, yPosition);
                yPosition += 10;
                
                // Calculation steps
                if (data.calculationSteps && data.calculationSteps.length > 0) {
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text('Calculation Steps:', 20, yPosition);
                    yPosition += 8;
                    
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    
                    data.calculationSteps.forEach(step => {
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        doc.text(`• ${step}`, 25, yPosition);
                        yPosition += 6;
                    });
                }
                
                // Footer
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text('This is a computer-generated report. For official purposes, refer to the actual pension processing documents.', 105, 285, { align: 'center' });
                
                // Save the PDF
                doc.save(`Gratuity_Calculation_${data.employeeName.replace(/\s+/g, '_')}.pdf`);
            }
        });
    </script>
</body>
</html>
