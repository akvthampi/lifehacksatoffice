
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leave Encashment Calculator for Central Government Employees</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset and base styles matching ppfcalc.html */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        html, body { 
            height: 100%; 
            width: 100%; 
            background: #0d1525; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            color: #e0e0e0; 
            line-height: 1.6;
        }
        
        body { 
            min-height: 100vh; 
            padding: 20px 19px; /* 19px ≈ 0.2 inches */
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            color: #e0e0e0;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 600;
            padding-left: 18px;
            letter-spacing: 1px;
            border-left: 4px solid #4d7cff;
            text-align: left;
            margin-left: 0;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            color: #a0a8c0;
            text-align: left;
            margin-left: 0;
            margin-top: 10px;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 30px;
            margin-bottom: 20px;
        }

        @media (max-width: 1200px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: #1a243d;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid #2a3450;
        }
        
        .section-title {
            color: #e0e0e0;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4d7cff;
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .input-section {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .output-section {
            display: flex;
            flex-direction: column;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #d0d8e8;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            background: #0d1525;
            border: 1px solid #2a3450;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            color: #e0e0e0;
        }
        
        input:focus, select:focus {
            border-color: #4d7cff;
            outline: none;
            box-shadow: 0 0 0 2px rgba(77, 124, 255, 0.3);
        }
        
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 8px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            border: 2px solid #2a3450;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background-color: #0d1525;
            font-size: 0.95rem;
        }

        .radio-option:hover {
            border-color: #4d7cff;
            background-color: #1a243d;
        }

        .radio-option input {
            margin: 0;
            width: 16px;
            height: 16px;
        }

        .radio-option input:checked + label {
            color: #4d7cff;
            font-weight: 600;
        }

        .radio-option label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
        }
        
        button {
            background: #4d7cff;
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(77, 124, 255, 0.3);
            background: #5d8cff;
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-success {
            background: #4CAF50;
        }
        
        .btn-success:hover {
            background: #5dbf61;
            box-shadow: 0 8px 15px rgba(76, 175, 80, 0.3);
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #2a3450;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: #d0d8e8;
        }
        
        .result-value {
            font-weight: 700;
            font-size: 1.1em;
        }
        
        .highlight {
            background: #0d1525;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4d7cff;
        }
        
        .note {
            font-size: 0.9rem;
            color: #a0a8c0;
            margin-top: 6px;
            font-style: italic;
        }
        
        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 0.95rem;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        .alert i {
            font-size: 1.3rem;
            margin-top: 2px;
        }
        
        .alert-info {
            background-color: #1a243d;
            border-left: 4px solid #4d7cff;
            color: #d0d8e8;
        }
        
        .alert-info i {
            color: #4d7cff;
        }
        
        .alert-success {
            background-color: #1a243d;
            border-left: 4px solid #4CAF50;
            color: #d0d8e8;
        }
        
        .alert-success i {
            color: #4CAF50;
        }
        
        .alert-warning {
            background-color: #1a243d;
            border-left: 4px solid #FF9800;
            color: #d0d8e8;
        }
        
        .alert-warning i {
            color: #FF9800;
        }
        
        .alert-danger {
            background-color: #1a243d;
            border-left: 4px solid #f44336;
            color: #d0d8e8;
        }
        
        .alert-danger i {
            color: #f44336;
        }
        
        .calculation-steps {
            margin-top: 20px;
            padding-top: 16px;
            border-top: 2px dashed #2a3450;
        }
        
        .step {
            margin-bottom: 12px;
            padding: 12px;
            background-color: #0d1525;
            border-radius: 8px;
            position: relative;
            padding-left: 40px;
        }
        
        .step-number {
            position: absolute;
            left: 12px;
            top: 12px;
            background: #4d7cff;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        footer {
            text-align: center;
            color: #a0a8c0;
            padding: 30px 0;
            margin-top: 30px;
            font-size: 0.9rem;
            background: #1a243d;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid #2a3450;
        }
        
        .date-inputs {
            display: flex;
            gap: 12px;
        }
        
        .date-inputs > div {
            flex: 1;
        }
        
        .hidden {
            display: none;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background: #0d1525;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
            transition: all 0.3s;
            border: 1px solid #2a3450;
        }
        
        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
        }
        
        .summary-card i {
            font-size: 2rem;
            margin-bottom: 12px;
        }
        
        .summary-card h3 {
            color: #e0e0e0;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .summary-card p {
            font-size: 1.5rem;
            font-weight: 700;
            color: #e0e0e0;
        }
        
        .service-card {
            background: linear-gradient(135deg, #2c7bb6 0%, #1a4f7a 100%);
            color: white;
        }
        
        .service-card i {
            color: #ffd700;
        }
        
        .amount-card {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            color: white;
        }
        
        .amount-card i {
            color: #ffd700;
        }
        
        .type-card {
            background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);
            color: white;
        }
        
        .type-card i {
            color: #ffd700;
        }
        
        .periods-card {
            background: linear-gradient(135deg, #fd7e14 0%, #e06a0d 100%);
            color: white;
        }
        
        .periods-card i {
            color: #ffd700;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .results-header h2 {
            margin: 0;
        }
        
        .export-btn-container {
            margin-top: auto;
            padding-top: 15px;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .app-container {
                gap: 15px;
            }
            
            .card {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8rem;
                text-align: center;
                padding-left: 0;
                border-left: none;
                border-bottom: 3px solid #4d7cff;
                padding-bottom: 10px;
                margin-left: 0;
                margin-right: 0;
            }
            
            .subtitle {
                text-align: center;
                margin-left: 0;
                margin-right: 0;
            }
            
            .date-inputs {
                flex-direction: column;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-calculator"></i> Leave Encashment Calculator</h1>
            <p class="subtitle">Designed by Anil Kumar VT | Calculated as per CCS (Leave) Rules</p>
        </header>

        <div class="app-container">
            <div class="input-section">
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-user"></i> Employee Details</h2>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="employeeName">Employee Name</label>
                            <input type="text" id="employeeName" class="form-control" placeholder="Enter full name">
                        </div>

                        <div class="form-group">
                            <label for="designation">Designation</label>
                            <input type="text" id="designation" class="form-control" placeholder="Enter designation">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="section-title"><i class="fas fa-clock"></i> Service Details</h2>
                    
                    <div class="form-group">
                        <label>Exit Type</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="retirement" name="exitType" value="retirement" checked>
                                <label for="retirement">Retirement</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="resignation" name="exitType" value="resignation">
                                <label for="resignation">Resignation</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="dateOfJoining">Date of Joining Service</label>
                            <input type="date" id="dateOfJoining" class="form-control">
                        </div>

                        <div class="form-group">
                            <label for="dateOfExit">Date of Exit</label>
                            <input type="date" id="dateOfExit" class="form-control">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="section-title"><i class="fas fa-money-bill-wave"></i> Emoluments & Leave Details</h2>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="basicPay">Basic Pay (₹)</label>
                            <input type="number" id="basicPay" class="form-control" min="0" placeholder="Enter basic pay">
                        </div>

                        <div class="form-group">
                            <label for="daPercentage">DA Percentage (%)</label>
                            <input type="number" id="daPercentage" class="form-control" min="0" max="100" step="0.01" placeholder="Enter DA percentage">
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="earnedLeave">EL at Credit</label>
                            <input type="number" id="earnedLeave" class="form-control" min="0" placeholder="Enter EL days">
                        </div>

                        <div class="form-group">
                            <label for="halfPayLeave">HPL at Credit</label>
                            <input type="number" id="halfPayLeave" class="form-control" min="0" placeholder="Enter HPL days">
                        </div>
                    </div>

                    <button id="calculateBtn"><i class="fas fa-calculator"></i> Calculate Leave Encashment</button>
                </div>
            </div>

            <div class="output-section">
                <div class="card" style="flex: 1; display: flex; flex-direction: column;">
                    <div class="results-header">
                        <h2 class="section-title"><i class="fas fa-chart-bar"></i> Calculation Results</h2>
                    </div>
                    
                    <div id="resultsContainer" style="flex: 1;">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <div>
                                <strong>Welcome to the Leave Encashment Calculator</strong>
                                <p>Please enter your details and click "Calculate Leave Encashment" to see results.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="export-btn-container">
                        <button id="exportPdfBtn" class="btn-success hidden"><i class="fas fa-file-pdf"></i> Export to PDF</button>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p><strong>Disclaimer:</strong> This calculator provides estimates based on the Central Civil Services Leave Rules. Actual leave encashment amounts may vary based on specific circumstances and official interpretations.</p>
            <p>© 2025 Advanced Leave Encashment Calculator for Central Government Employees</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculateBtn');
            const exportPdfBtn = document.getElementById('exportPdfBtn');
            const resultsContainer = document.getElementById('resultsContainer');
            
            calculateBtn.addEventListener('click', calculateLeaveEncashment);
            exportPdfBtn.addEventListener('click', exportToPdf);
            
            function calculateLeaveEncashment() {
                // Get employee details
                const employeeName = document.getElementById('employeeName').value.trim();
                const designation = document.getElementById('designation').value.trim();
                
                // Get exit type
                const exitType = document.querySelector('input[name="exitType"]:checked').value;
                
                // Get dates
                const dateOfJoining = new Date(document.getElementById('dateOfJoining').value);
                const dateOfExit = new Date(document.getElementById('dateOfExit').value);
                
                // Get emoluments details
                const basicPay = parseFloat(document.getElementById('basicPay').value) || 0;
                const daPercentage = parseFloat(document.getElementById('daPercentage').value) || 0;
                
                // Get leave details
                const earnedLeave = parseInt(document.getElementById('earnedLeave').value) || 0;
                const halfPayLeave = parseInt(document.getElementById('halfPayLeave').value) || 0;
                
                // Validate inputs
                if (!employeeName || employeeName === "") {
                    showError("Please enter employee name.");
                    return;
                }
                
                if (!designation || designation === "") {
                    showError("Please enter designation.");
                    return;
                }
                
                if (isNaN(dateOfJoining.getTime()) || document.getElementById('dateOfJoining').value === "") {
                    showError("Please enter a valid date of joining.");
                    return;
                }
                
                if (isNaN(dateOfExit.getTime()) || document.getElementById('dateOfExit').value === "") {
                    showError("Please enter a valid date of exit.");
                    return;
                }
                
                if (basicPay <= 0) {
                    showError("Please enter a valid basic pay value greater than zero.");
                    return;
                }
                
                if (daPercentage < 0) {
                    showError("Please enter a valid DA percentage value (0 or greater).");
                    return;
                }
                
                if (earnedLeave < 0) {
                    showError("Please enter a valid Earned Leave days value (0 or greater).");
                    return;
                }
                
                if (halfPayLeave < 0) {
                    showError("Please enter a valid Half Pay Leave days value (0 or greater).");
                    return;
                }
                
                // Calculate service period
                const servicePeriod = calculateServicePeriod(dateOfJoining, dateOfExit);
                const years = servicePeriod.years;
                const months = servicePeriod.months;
                const totalMonths = years * 12 + months;
                
                // Calculate emoluments
                const daAmount = basicPay * (daPercentage / 100);
                const totalEmoluments = basicPay + daAmount;
                
                // Initialize variables for calculation
                let elDaysToEncash = 0;
                let hplDaysToEncash = 0;
                let elEncashmentAmount = 0;
                let hplEncashmentAmount = 0;
                let totalEncashmentAmount = 0;
                let calculationSteps = [];
                let notes = [];
                
                if (exitType === 'retirement') {
                    // Retirement case: Full EL encashment, then HPL if needed up to 300 days
                    
                    calculationSteps.push("Eligibility: Full leave encashment allowed on retirement");
                    calculationSteps.push(`Total Earned Leave Available: ${earnedLeave} days`);
                    calculationSteps.push(`Total Half Pay Leave Available: ${halfPayLeave} days`);
                    
                    if (earnedLeave >= 300) {
                        // If EL alone is 300 or more days
                        elDaysToEncash = 300;
                        hplDaysToEncash = 0;
                        calculationSteps.push(`Using only Earned Leave: 300 days (maximum limit reached)`);
                    } else {
                        // EL is less than 300 days, use HPL to make up the difference
                        elDaysToEncash = earnedLeave;
                        const remainingDays = 300 - earnedLeave;
                        hplDaysToEncash = Math.min(halfPayLeave, remainingDays);
                        calculationSteps.push(`Earned Leave Used: ${earnedLeave} days`);
                        calculationSteps.push(`Additional days needed: ${remainingDays} days`);
                        calculationSteps.push(`Half Pay Leave Used: ${hplDaysToEncash} days (out of ${halfPayLeave} available)`);
                    }
                    
                    // Calculate amounts
                    elEncashmentAmount = (totalEmoluments / 30) * elDaysToEncash;
                    hplEncashmentAmount = (totalEmoluments / 60) * hplDaysToEncash;
                    totalEncashmentAmount = elEncashmentAmount + hplEncashmentAmount;
                    
                    calculationSteps.push(`Formula for EL Encashment: (Pay + DA) / 30 * EL Days`);
                    calculationSteps.push(`EL Calculation: Rs.${totalEmoluments.toLocaleString()} / 30 * ${elDaysToEncash} = Rs.${elEncashmentAmount.toLocaleString()}`);
                    calculationSteps.push(`Formula for HPL Encashment: (Pay + DA) / 60 * HPL Days`);
                    calculationSteps.push(`HPL Calculation: Rs.${totalEmoluments.toLocaleString()} / 60 * ${hplDaysToEncash} = Rs.${hplEncashmentAmount.toLocaleString()}`);
                    calculationSteps.push(`Total Encashment: Rs.${elEncashmentAmount.toLocaleString()} + Rs.${hplEncashmentAmount.toLocaleString()} = Rs.${totalEncashmentAmount.toLocaleString()}`);
                    
                    // Add notes about unused leaves
                    const unusedEL = earnedLeave - elDaysToEncash;
                    const unusedHPL = halfPayLeave - hplDaysToEncash;
                    if (unusedEL > 0) {
                        notes.push(`${unusedEL} days of Earned Leave will remain unused.`);
                    }
                    if (unusedHPL > 0) {
                        notes.push(`${unusedHPL} days of Half Pay Leave will remain unused.`);
                    }
                    
                } else {
                    // Resignation/Quitting case: Only 50% of EL encashment allowed, HPL lapses
                    
                    calculationSteps.push("Eligibility: Only 50% of Earned Leave encashment allowed on resignation/quitting");
                    calculationSteps.push(`Total Earned Leave Available: ${earnedLeave} days`);
                    calculationSteps.push(`Half Pay Leave Lapses: ${halfPayLeave} days (not encashable)`);
                    
                    elDaysToEncash = Math.floor(earnedLeave * 0.5);
                    hplDaysToEncash = 0;
                    elEncashmentAmount = (totalEmoluments / 30) * elDaysToEncash;
                    hplEncashmentAmount = 0;
                    totalEncashmentAmount = elEncashmentAmount;
                    
                    calculationSteps.push(`Earned Leave to Encash: 50% of ${earnedLeave} = ${elDaysToEncash} days`);
                    calculationSteps.push(`Formula for EL Encashment: (Pay + DA) / 30 * EL Days`);
                    calculationSteps.push(`EL Calculation: Rs.${totalEmoluments.toLocaleString()} / 30 * ${elDaysToEncash} = Rs.${elEncashmentAmount.toLocaleString()}`);
                    calculationSteps.push(`HPL Encashment: Rs.0 (not allowed on resignation)`);
                    calculationSteps.push(`Total Encashment: Rs.${totalEncashmentAmount.toLocaleString()}`);
                    
                    // Add note about lapsed HPL
                    notes.push(`${halfPayLeave} days of Half Pay Leave will lapse.`);
                    const unusedEL = earnedLeave - elDaysToEncash;
                    if (unusedEL > 0) {
                        notes.push(`${unusedEL} days of Earned Leave will remain unused.`);
                    }
                }
                
                // Round up to the next higher rupee if there's a fraction
                if (totalEncashmentAmount % 1 !== 0) {
                    const originalAmount = totalEncashmentAmount;
                    totalEncashmentAmount = Math.ceil(totalEncashmentAmount);
                    calculationSteps.push(`Rounded up to next higher rupee: Rs.${originalAmount.toFixed(2)} → Rs.${totalEncashmentAmount.toLocaleString()}`);
                }
                
                // Store data for PDF export
                window.calculationData = {
                    employeeName,
                    designation,
                    exitType,
                    dateOfJoining: formatDate(dateOfJoining),
                    dateOfExit: formatDate(dateOfExit),
                    years,
                    months,
                    totalMonths,
                    basicPay,
                    daPercentage,
                    daAmount,
                    totalEmoluments,
                    earnedLeave,
                    halfPayLeave,
                    elDaysToEncash,
                    hplDaysToEncash,
                    elEncashmentAmount,
                    hplEncashmentAmount,
                    totalEncashmentAmount,
                    calculationSteps,
                    notes
                };
                
                // Display results
                displayResults();
                exportPdfBtn.classList.remove('hidden');
            }
            
            function calculateServicePeriod(startDate, endDate) {
                let years = endDate.getFullYear() - startDate.getFullYear();
                let months = endDate.getMonth() - startDate.getMonth();
                
                if (months < 0) {
                    years--;
                    months += 12;
                }
                
                // Adjust for day of month
                if (endDate.getDate() < startDate.getDate()) {
                    months--;
                    if (months < 0) {
                        years--;
                        months += 12;
                    }
                }
                
                return { years, months };
            }
            
            function formatDate(date) {
                return date.toLocaleDateString('en-IN', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            }
            
            function displayResults() {
                const data = window.calculationData;
                
                // Create summary cards
                let summaryCards = `
                    <div class="summary-cards">
                        <div class="summary-card amount-card">
                            <i class="fas fa-rupee-sign"></i>
                            <h3>Encashment Amount</h3>
                            <p>Rs.${data.totalEncashmentAmount.toLocaleString()}</p>
                        </div>
                        
                        <div class="summary-card service-card">
                            <i class="fas fa-calendar-alt"></i>
                            <h3>Service Period</h3>
                            <p>${data.years}Y ${data.months}M</p>
                        </div>
                        
                        <div class="summary-card type-card">
                            <i class="fas fa-tag"></i>
                            <h3>Exit Type</h3>
                            <p>${data.exitType.charAt(0).toUpperCase() + data.exitType.slice(1)}</p>
                        </div>
                        
                        <div class="summary-card periods-card">
                            <i class="fas fa-leaf"></i>
                            <h3>Total Days Encashed</h3>
                            <p>${data.elDaysToEncash + data.hplDaysToEncash}</p>
                        </div>
                    </div>
                `;
                
                // Create detailed results
                let resultsHTML = `
                    ${summaryCards}
                    
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <strong>Leave Encashment Calculation Complete</strong>
                            <p>Your leave encashment has been calculated successfully based on the provided details.</p>
                        </div>
                    </div>
                    
                    <div class="result-item highlight">
                        <div class="result-label">Final Leave Encashment Amount</div>
                        <div class="result-value">Rs.${data.totalEncashmentAmount.toLocaleString()}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Employee Name</div>
                        <div class="result-value">${data.employeeName}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Designation</div>
                        <div class="result-value">${data.designation}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Exit Type</div>
                        <div class="result-value">${data.exitType.charAt(0).toUpperCase() + data.exitType.slice(1)}</div>
                    </div>
                `;
                
                resultsHTML += `
                    <div class="result-item">
                        <div class="result-label">Date of Joining</div>
                        <div class="result-value">${data.dateOfJoining}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Date of Exit</div>
                        <div class="result-value">${data.dateOfExit}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Qualifying Service</div>
                        <div class="result-value">${data.years} Years ${data.months} Months (${data.totalMonths} months)</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Basic Pay</div>
                        <div class="result-value">Rs.${data.basicPay.toLocaleString()}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Dearness Allowance (${data.daPercentage}%)</div>
                        <div class="result-value">Rs.${data.daAmount.toLocaleString()}</div>
                    </div>
                    
                    <div class="result-item highlight">
                        <div class="result-label">Total Emoluments (Pay + DA)</div>
                        <div class="result-value">Rs.${data.totalEmoluments.toLocaleString()}</div>
                    </div>
                `;
                
                // Add leave details
                resultsHTML += `
                    <div class="result-item">
                        <div class="result-label">Earned Leave Available</div>
                        <div class="result-value">${data.earnedLeave} days</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Half Pay Leave Available</div>
                        <div class="result-value">${data.halfPayLeave} days</div>
                    </div>
                `;
                
                // Add encashment details
                resultsHTML += `
                    <div class="result-item">
                        <div class="result-label">Earned Leave Encashed</div>
                        <div class="result-value">${data.elDaysToEncash} days</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Half Pay Leave Encashed</div>
                        <div class="result-value">${data.hplDaysToEncash} days</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">EL Encashment Amount</div>
                        <div class="result-value">Rs.${data.elEncashmentAmount.toLocaleString()}</div>
                        <div class="note">Formula: (Pay + DA) / 30 * EL Days</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">HPL Encashment Amount</div>
                        <div class="result-value">Rs.${data.hplEncashmentAmount.toLocaleString()}</div>
                        <div class="note">Formula: (Pay + DA) / 60 * HPL Days</div>
                    </div>
                `;
                
                // Add calculation steps
                if (data.calculationSteps && data.calculationSteps.length > 0) {
                    resultsHTML += `
                        <div class="calculation-steps">
                            <h3 class="section-title"><i class="fas fa-calculator"></i> Calculation Steps</h3>
                            ${data.calculationSteps.map((step, index) => `
                                <div class="step">
                                    <div class="step-number">${index + 1}</div>
                                    <div>${step}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                // Add notes
                if (data.notes && data.notes.length > 0) {
                    resultsHTML += `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>
                                <strong>Important Notes:</strong>
                                <ul style="margin-top: 8px; margin-left: 20px;">
                                    ${data.notes.map(note => `<li>${note}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    `;
                }
                
                // Add important rules
                resultsHTML += `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>Important Rules:</strong>
                            <ul style="margin-top: 8px; margin-left: 20px;">
                                <li>On Retirement: Up to 300 days can be encashed (EL first, then HPL)</li>
                                <li>On Resignation: Only 50% of EL can be encashed, HPL lapses</li>
                                <li>EL Encashment Formula: (Pay + DA) / 30 * EL Days</li>
                                <li>HPL Encashment Formula: (Pay + DA) / 60 * HPL Days</li>
                            </ul>
                        </div>
                    </div>
                `;
                
                resultsContainer.innerHTML = resultsHTML;
            }
            
            function showError(message) {
                resultsContainer.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <strong>Error</strong>
                            <p>${message}</p>
                        </div>
                    </div>
                `;
                exportPdfBtn.classList.add('hidden');
            }
            
            function exportToPdf() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const data = window.calculationData;
                
                // Set up PDF content
                let yPosition = 20;
                
                // Title
                doc.setFontSize(20);
                doc.setTextColor(77, 124, 255);
                doc.text("Leave Encashment Calculation", 20, yPosition);
                yPosition += 15;
                
                // Subtitle
                doc.setFontSize(12);
                doc.setTextColor(128, 128, 128);
                doc.text("Calculated as per CCS (Leave) Rules", 20, yPosition);
                yPosition += 20;
                
                // Employee details
                doc.setFontSize(14);
                doc.setTextColor(0, 0, 0);
                doc.text("Employee Details:", 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.text(`Name: ${data.employeeName}`, 30, yPosition);
                yPosition += 7;
                doc.text(`Designation: ${data.designation}`, 30, yPosition);
                yPosition += 7;
                doc.text(`Exit Type: ${data.exitType.charAt(0).toUpperCase() + data.exitType.slice(1)}`, 30, yPosition);
                yPosition += 7;
                doc.text(`Date of Joining: ${data.dateOfJoining}`, 30, yPosition);
                yPosition += 7;
                doc.text(`Date of Exit: ${data.dateOfExit}`, 30, yPosition);
                yPosition += 7;
                doc.text(`Qualifying Service: ${data.years} Years ${data.months} Months`, 30, yPosition);
                yPosition += 15;
                
                // Emoluments
                doc.setFontSize(14);
                doc.text("Emoluments:", 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.text(`Basic Pay: Rs.${data.basicPay.toLocaleString()}`, 30, yPosition);
                yPosition += 7;
                doc.text(`Dearness Allowance (${data.daPercentage}%): Rs.${data.daAmount.toLocaleString()}`, 30, yPosition);
                yPosition += 7;
                doc.text(`Total Emoluments: Rs.${data.totalEmoluments.toLocaleString()}`, 30, yPosition);
                yPosition += 15;
                
                // Leave details
                doc.setFontSize(14);
                doc.text("Leave Details:", 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.text(`Earned Leave Available: ${data.earnedLeave} days`, 30, yPosition);
                yPosition += 7;
                doc.text(`Half Pay Leave Available: ${data.halfPayLeave} days`, 30, yPosition);
                yPosition += 7;
                doc.text(`Earned Leave Encashed: ${data.elDaysToEncash} days`, 30, yPosition);
                yPosition += 7;
                doc.text(`Half Pay Leave Encashed: ${data.hplDaysToEncash} days`, 30, yPosition);
                yPosition += 15;
                
                // Encashment details
                doc.setFontSize(14);
                doc.text("Encashment Details:", 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.text(`EL Encashment Amount: Rs.${data.elEncashmentAmount.toLocaleString()}`, 30, yPosition);
                yPosition += 7;
                doc.text(`HPL Encashment Amount: Rs.${data.hplEncashmentAmount.toLocaleString()}`, 30, yPosition);
                yPosition += 7;
                
                // Total amount
                doc.setFontSize(16);
                doc.setTextColor(0, 128, 0);
                doc.text(`Total Leave Encashment Amount: Rs.${data.totalEncashmentAmount.toLocaleString()}`, 20, yPosition);
                yPosition += 20;
                
                // Notes
                if (data.notes && data.notes.length > 0) {
                    doc.setFontSize(14);
                    doc.setTextColor(0, 0, 0);
                    doc.text("Notes:", 20, yPosition);
                    yPosition += 10;
                    
                    doc.setFontSize(10);
                    data.notes.forEach(note => {
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        doc.text(`• ${note}`, 25, yPosition);
                        yPosition += 7;
                    });
                }
                
                // Footer
                doc.setFontSize(10);
                doc.setTextColor(128, 128, 128);
                doc.text("Generated by Leave Encashment Calculator", 20, 285);
                doc.text("Calculated as per CCS (Leave) Rules", 20, 290);
                
                // Save the PDF
                doc.save(`Leave_Encashment_${data.employeeName.replace(/\s+/g, '_')}.pdf`);
            }
        });
    </script>
</body>
</html>
